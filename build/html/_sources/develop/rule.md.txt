# Develop Rule

## åˆ†æ”¯å‘½åè§„èŒƒ

**master åˆ†æ”¯**

master ä¸ºä¸»åˆ†æ”¯ï¼Œä¹Ÿæ˜¯ç”¨äºéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒçš„åˆ†æ”¯ï¼Œç¡®ä¿masteråˆ†æ”¯ç¨³å®šæ€§

master åˆ†æ”¯ä¸€èˆ¬ç”±developä»¥åŠhotfixåˆ†æ”¯åˆå¹¶ï¼Œä»»ä½•æ—¶é—´éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹ä»£ç 

**develop åˆ†æ”¯**

develop ä¸ºå¼€å‘åˆ†æ”¯ï¼Œå§‹ç»ˆä¿æŒæœ€æ–°å®Œæˆä»¥åŠbugä¿®å¤åçš„ä»£ç 

ä¸€èˆ¬å¼€å‘çš„æ–°åŠŸèƒ½æ—¶ï¼Œfeatureåˆ†æ”¯éƒ½æ˜¯åŸºäºdevelopåˆ†æ”¯ä¸‹åˆ›å»ºçš„

**feature åˆ†æ”¯**

å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œä»¥developä¸ºåŸºç¡€åˆ›å»ºfeatureåˆ†æ”¯

åˆ†æ”¯å‘½å: feature/ å¼€å¤´çš„ä¸ºç‰¹æ€§åˆ†æ”¯ï¼Œ å‘½åè§„åˆ™: feature/user_moduleã€ feature/cart_module

**releaseåˆ†æ”¯**
release ä¸ºé¢„ä¸Šçº¿åˆ†æ”¯ï¼Œå‘å¸ƒææµ‹é˜¶æ®µï¼Œä¼šreleaseåˆ†æ”¯ä»£ç ä¸ºåŸºå‡†ææµ‹

    å½“æœ‰ä¸€ç»„featureå¼€å‘å®Œæˆï¼Œé¦–å…ˆä¼šåˆå¹¶åˆ°developåˆ†æ”¯ï¼Œè¿›å…¥ææµ‹æ—¶ï¼Œä¼šåˆ›å»ºreleaseåˆ†æ”¯ã€‚å¦‚æœæµ‹è¯•è¿‡ç¨‹ä¸­è‹¥å­˜åœ¨bugéœ€è¦ä¿®å¤ï¼Œåˆ™ç›´æ¥ç”±å¼€å‘è€…åœ¨releaseåˆ†æ”¯ä¿®å¤å¹¶æäº¤ã€‚å½“æµ‹è¯•å®Œæˆä¹‹åï¼Œåˆå¹¶releaseåˆ†æ”¯åˆ°masterå’Œdevelopåˆ†æ”¯ï¼Œæ­¤æ—¶masterä¸ºæœ€æ–°ä»£ç ï¼Œç”¨ä½œä¸Šçº¿ã€‚

**hotfix åˆ†æ”¯**

åˆ†æ”¯å‘½å: hotfix/ å¼€å¤´çš„ä¸ºä¿®å¤åˆ†æ”¯ï¼Œå®ƒçš„å‘½åè§„åˆ™ä¸ feature åˆ†æ”¯ç±»ä¼¼

çº¿ä¸Šå‡ºç°ç´§æ€¥é—®é¢˜æ—¶ï¼Œéœ€è¦åŠæ—¶ä¿®å¤ï¼Œä»¥masteråˆ†æ”¯ä¸ºåŸºçº¿ï¼Œåˆ›å»ºhotfixåˆ†æ”¯ï¼Œä¿®å¤å®Œæˆåï¼Œéœ€è¦åˆå¹¶åˆ°masteråˆ†æ”¯å’Œdevelopåˆ†æ”¯

### ä¸¾æ —å­ğŸŒ°ğŸŒ°ğŸŒ°

#### å¢åŠ æ–°åŠŸèƒ½

```
(dev)$: git checkout -b feature/xxx            # ä»devå»ºç«‹ç‰¹æ€§åˆ†æ”¯
(feature/xxx)$: blabla                         # å¼€å‘
(feature/xxx)$: git add xxx
(feature/xxx)$: git commit -m 'commit comment'
(dev)$: git merge feature/xxx --no-ff          # æŠŠç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°dev
```

#### ä¿®å¤ç´§æ€¥bug

```
(master)$: git checkout -b hotfix/xxx         # ä»masterå»ºç«‹hotfixåˆ†æ”¯
(hotfix/xxx)$: blabla                         # å¼€å‘
(hotfix/xxx)$: git add xxx
(hotfix/xxx)$: git commit -m 'commit comment'
(master)$: git merge hotfix/xxx --no-ff       # æŠŠhotfixåˆ†æ”¯åˆå¹¶åˆ°masterï¼Œå¹¶ä¸Šçº¿åˆ°ç”Ÿäº§ç¯å¢ƒ
(dev)$: git merge hotfix/xxx --no-ff          # æŠŠhotfixåˆ†æ”¯åˆå¹¶åˆ°devï¼ŒåŒæ­¥ä»£ç 
```

#### æµ‹è¯•ç¯å¢ƒä»£ç 

```
(release)$: git merge dev --no-ff             # æŠŠdevåˆ†æ”¯åˆå¹¶åˆ°releaseï¼Œç„¶ååœ¨æµ‹è¯•ç¯å¢ƒæ‹‰å–å¹¶æµ‹è¯•
```

#### ç”Ÿäº§ç¯å¢ƒä¸Šçº¿

```
(master)$: git merge release --no-ff          # æŠŠreleaseæµ‹è¯•å¥½çš„ä»£ç åˆå¹¶åˆ°masterï¼Œè¿ç»´äººå‘˜æ“ä½œ
(master)$: git tag -a v0.1 -m 'éƒ¨ç½²åŒ…ç‰ˆæœ¬å'  #ç»™ç‰ˆæœ¬å‘½åï¼Œæ‰“Tag
```

![](./pic/devflow.png)

## æ—¥å¿—è§„èŒƒ

åœ¨ä¸€ä¸ªå›¢é˜Ÿåä½œçš„é¡¹ç›®ä¸­ï¼Œå¼€å‘äººå‘˜éœ€è¦ç»å¸¸æäº¤ä¸€äº›ä»£ç å»ä¿®å¤bugæˆ–è€…å®ç°æ–°çš„featureã€‚è€Œé¡¹ç›®ä¸­çš„æ–‡ä»¶å’Œå®ç°ä»€ä¹ˆåŠŸèƒ½ã€è§£å†³ä»€ä¹ˆé—®é¢˜éƒ½ä¼šæ¸æ¸æ·¡å¿˜ï¼Œæœ€åéœ€è¦æµªè´¹æ—¶é—´å»é˜…è¯»ä»£ç ã€‚ä½†æ˜¯å¥½çš„æ—¥å¿—è§„èŒƒcommit messagesç¼–å†™æœ‰å¸®åŠ©åˆ°æˆ‘ä»¬ï¼Œå®ƒä¹Ÿåæ˜ äº†ä¸€ä¸ªå¼€å‘äººå‘˜æ˜¯å¦æ˜¯è‰¯å¥½çš„åä½œè€…ã€‚

ç¼–å†™è‰¯å¥½çš„Commit messageså¯ä»¥è¾¾åˆ°3ä¸ªé‡è¦çš„ç›®çš„ï¼š

- åŠ å¿«reviewçš„æµç¨‹
- å¸®åŠ©æˆ‘ä»¬ç¼–å†™è‰¯å¥½çš„ç‰ˆæœ¬å‘å¸ƒæ—¥å¿—
- è®©ä¹‹åçš„ç»´æŠ¤è€…äº†è§£ä»£ç é‡Œå‡ºç°ç‰¹å®šå˜åŒ–å’Œfeatureè¢«æ·»åŠ çš„åŸå› 

ç›®å‰ï¼Œç¤¾åŒºæœ‰å¤šç§ Commit message çš„å†™æ³•è§„èŒƒã€‚æ¥è‡ªAngular è§„èŒƒæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„å†™æ³•ï¼Œæ¯”è¾ƒåˆç†å’Œç³»ç»ŸåŒ–ã€‚

### Commit message æ ¼å¼

å…·ä½“æ ¼å¼ä¸º:

```
<type>: <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

- type: æœ¬æ¬¡ commit çš„ç±»å‹ï¼Œè¯¸å¦‚ bugfix docs style ç­‰
- scope: æœ¬æ¬¡ commit æ³¢åŠçš„èŒƒå›´
- subject: ç®€æ˜æ‰¼è¦çš„é˜è¿°ä¸‹æœ¬æ¬¡ commit çš„ä¸»æ—¨ï¼Œåœ¨åŸæ–‡ä¸­ç‰¹æ„å¼ºè°ƒäº†å‡ ç‚¹ 
    1. ä½¿ç”¨ç¥ˆä½¿å¥ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰åˆé™Œç”Ÿçš„ä¸€ä¸ªè¯ï¼Œæ¥ä¼ é€é—¨åœ¨æ­¤ ç¥ˆä½¿å¥ 
    2. é¦–å­—æ¯ä¸è¦å¤§å†™ 
    3. ç»“å°¾æ— éœ€æ·»åŠ æ ‡ç‚¹
- body: åŒæ ·ä½¿ç”¨ç¥ˆä½¿å¥ï¼Œåœ¨ä¸»ä½“å†…å®¹ä¸­æˆ‘ä»¬éœ€è¦æŠŠæœ¬æ¬¡ commit è¯¦ç»†çš„æè¿°ä¸€ä¸‹ï¼Œæ¯”å¦‚æ­¤æ¬¡å˜æ›´çš„åŠ¨æœºï¼Œå¦‚éœ€æ¢è¡Œï¼Œåˆ™ä½¿ç”¨ |
- footer: æè¿°ä¸‹ä¸ä¹‹å…³è”çš„ issue æˆ– break changeï¼Œè¯¦è§æ¡ˆä¾‹

#### Typeçš„ç±»åˆ«è¯´æ˜

- feat: æ·»åŠ æ–°ç‰¹æ€§
- fix: ä¿®å¤bug
- docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£
- style: ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€éƒ½å¥½ç­‰ç­‰ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘
- refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰åŠ æ–°åŠŸèƒ½æˆ–è€…ä¿®å¤bug
- perf: å¢åŠ ä»£ç è¿›è¡Œæ€§èƒ½æµ‹è¯•
- test: å¢åŠ æµ‹è¯•ç”¨ä¾‹
- chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰

### Commit messagesæ ¼å¼è¦æ±‚

```
# æ ‡é¢˜è¡Œï¼š50ä¸ªå­—ç¬¦ä»¥å†…ï¼Œæè¿°ä¸»è¦å˜æ›´å†…å®¹
#
# ä¸»ä½“å†…å®¹ï¼šæ›´è¯¦ç»†çš„è¯´æ˜æ–‡æœ¬ï¼Œå»ºè®®72ä¸ªå­—ç¬¦ä»¥å†…ã€‚ éœ€è¦æè¿°çš„ä¿¡æ¯åŒ…æ‹¬:
#
# * ä¸ºä»€ä¹ˆè¿™ä¸ªå˜æ›´æ˜¯å¿…é¡»çš„? å®ƒå¯èƒ½æ˜¯ç”¨æ¥ä¿®å¤ä¸€ä¸ªbugï¼Œå¢åŠ ä¸€ä¸ªfeatureï¼Œæå‡æ€§èƒ½ã€å¯é æ€§ã€ç¨³å®šæ€§ç­‰ç­‰
# * ä»–å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜? å…·ä½“æè¿°è§£å†³é—®é¢˜çš„æ­¥éª¤
# * æ˜¯å¦å­˜åœ¨å‰¯ä½œç”¨ã€é£é™©? 
#
# å¦‚æœéœ€è¦çš„åŒ–å¯ä»¥æ·»åŠ ä¸€ä¸ªé“¾æ¥åˆ°issueåœ°å€æˆ–è€…å…¶å®ƒæ–‡æ¡£
```

## å…³è”ä»“åº“çš„ç®¡ç†

æ¶‰åŠå†…éƒ¨ä»“åº“ä¹‹é—´çš„å¼•ç”¨é‡‡ç”¨ submodule è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¯¹äºå¯å¼€æºå‘å¸ƒçš„ç‰ˆæœ¬ç®¡ç†é‡‡ç”¨åŒ…ç®¡ç†ï¼Œæ¯”å¦‚pipã€npmã€go getã€‚

ä¸»é¡¹ç›®ç®¡ç†å½¢å¼å¦‚ä¸‹ï¼š

```
A(ä¸»é¡¹ç›®) --> B(commonå…¬å…±æ¨¡å—)
|
|---> C(åŒ…ç®¡ç†)
|
|---> D(å…¶ä»–ä»“åº“)
```

å°†å¼•ç”¨é¡¹ç›®ä½œä¸ºsubmoduleæ·»åŠ åˆ°ä¸»é¡¹ç›®ä¸­ï¼š

```shell
# æ·»åŠ submodule
git submodule add <è¿œç¨‹å¼•ç”¨æ¨¡å—ä»“åº“åœ°å€>
```

å­é¡¹ç›®ç‰ˆæœ¬ç®¡ç†å’Œä¸»é¡¹ç›®ç‰ˆæœ¬ç®¡ç†æ˜¯åˆ†å‘çš„ï¼Œä¸»é¡¹ç›®ä¸­çš„å­é¡¹ç›®æ›´æ–°éœ€è¦æ‰‹åŠ¨æ“ä½œï¼š

```shell
# æ›´æ–°å­æ¨¡å—
git submodule update --init
```

## Reference

- https://blog.csdn.net/weixin_44786530/article/details/129403495

- https://www.cnblogs.com/heroljy/p/9294127.html