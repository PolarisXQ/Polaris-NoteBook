<!DOCTYPE html>
<html  lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>rm_decision</title>
    
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../../_static/theme-vendors.js"></script> -->
      <script src="../../_static/theme.js" defer></script>
    
      <link rel="shortcut icon" href="../../_static/madcat_mini.png"/>
  <link rel="index" title="索引" href="../../genindex.html" />
  <link rel="search" title="搜索" href="../../search.html" />
  <link rel="next" title="Probablistic Robotics" href="ProbablisticRobotics.html" />
  <link rel="prev" title="Manage how the callbaks are called: Exeturos &amp; CallbackGroups &amp; Qos" href="../ROS/executos.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../index.html" class="home-link">
    
      <img class="logo" src="../../_static/madcat_mini.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Daily Report
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         System
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Development Related
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Docker
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         SLAM
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Navigation
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         ROS
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link  router-link-active">
         Robotics etc.
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         CV
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Miscellaneous
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/PolarisXQ"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Daily Report
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         System
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Development Related
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Docker
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         SLAM
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Navigation
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         ROS
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link  router-link-active">
         Robotics etc.
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         CV
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Miscellaneous
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/PolarisXQ"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">快速搜索</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="搜索" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Daily Report</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../report/report.html" class="reference internal ">开发记录(09.15-10.31)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../report/report2.html" class="reference internal ">开发记录(11.01-12.31)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../report/report3.html" class="reference internal ">开发记录 2024.01.01-now</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">System</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Sys/Linux/bind_device.html" class="reference internal ">Bind a USB device under a static name</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Sys/Linux/Miscellaneous.html" class="reference internal ">Miscellaneous</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Development Related</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../develop/rule.html" class="reference internal ">开发的姿势</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/submodel.html" class="reference internal ">关联仓库的管理</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/CI.html" class="reference internal ">配置CI节点</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/git.html" class="reference internal ">GIT</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Docker</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/docker.html" class="reference internal ">Dockernize Everything!</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/DevContainer.html" class="reference internal ">DevContainer: What Why and How[Optional]</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/workflow.html" class="reference internal ">Introduce to our WorkFlow</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/CustomImage.html" class="reference internal ">Step by Step in detail: Prepare Docker Image</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/RunDevEnv.html" class="reference internal ">Step by Step in detail: Launch the Development Workspace</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/CI.html" class="reference internal ">Step by Step in detail: Continuous Integration</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/deploy.html" class="reference internal ">Step by Step in detail: Deploy in NUC</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/UsefulCommand.html" class="reference internal ">Some Useful Command for Docker</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">SLAM</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/overview.html" class="reference internal ">A Simple Overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/RecommendReading.html" class="reference internal ">阅读推荐</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/relocalization.html" class="reference internal ">Relocalization Method</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/Traditional/ORB-SLAM3.html" class="reference internal ">ORB_SLAM</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/SLAM_w_NN.html" class="reference internal ">SLAM with Nerual Network</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/MID360.html" class="reference internal ">MID360激光雷达的装配说明</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/PCL.html" class="reference internal ">Learing PCL</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/KalmanFilter.html" class="reference internal ">Learning Kalman Filter</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/Lidar_Slam.html" class="reference internal ">Learning Lidar Slam</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Navigation</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/Overview.html" class="reference internal ">Robot Path Planning</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/CMUSeries.html" class="reference internal ">CMU Exploration Series</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/PathTracking.html" class="reference internal ">Path Tracking Algorithms Overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/farplanner_param.html" class="reference internal ">FarPlanner调参笔记</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/control.html" class="reference internal ">Learning Control</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">ROS</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../ROS/aboutTF.html" class="reference internal ">Learning TF2</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../ROS/migration.html" class="reference internal ">ROS -> ROS2 Migration Guide</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../ROS/msg_filter.html" class="reference internal ">Message_filter and TimeSynchronizer</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../ROS/Composition.html" class="reference internal ">Composition and Intra-process Communication</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../ROS/executos.html" class="reference internal ">Manage how the callbaks are called: Exeturos & CallbackGroups & Qos</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Robotics etc.</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">rm_decision</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#install-behaviortree-cpp" class="reference internal">1. Install BehaviorTree.CPP</a></li>
                
                  <li class="toctree-l2"><a href="#a-intro" class="reference internal">2. A INTRO</a></li>
                
                  <li class="toctree-l2"><a href="#learning-from-a-detailed-example" class="reference internal">3. Learning From a Detailed Example</a></li>
                
                  <li class="toctree-l2"><a href="#usual-mistakes" class="reference internal">Usual Mistakes</a></li>
                
                  <li class="toctree-l2"><a href="#reference-resources" class="reference internal">Reference & Resources</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="ProbablisticRobotics.html" class="reference internal ">Probablistic Robotics</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">CV</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../CV/basic.html" class="reference internal ">Basic</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/Yolo.html" class="reference internal ">Yolo</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/multiobj_track.html" class="reference internal ">Tracking Multi-Objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/issue.html" class="reference internal ">Miscellaneous things</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Miscellaneous</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/migrationcv3tocv4.html" class="reference internal ">Migrate from OpenCV3 to CV4</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/roadtoslam.html" class="reference internal ">On the bumpy road to SLAM</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/Cmake.html" class="reference internal ">How to ues Cmake</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/develowithnuc.html" class="reference internal ">Develop With NUC</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/JKB-NetWork.html" class="reference internal ">SCU极客邦服务器使用指南</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
    <li>rm_decision</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../ROS/executos.html"
       title="上一章">← Manage how the callbaks are called: Exeturos &amp; CallbackGroups &amp; Qos</a>
  </li>
  <li class="next">
    <a href="ProbablisticRobotics.html"
       title="下一章">Probablistic Robotics →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section class="tex2jax_ignore mathjax_ignore" id="rm-decision">
<h1>rm_decision<a class="headerlink" href="#rm-decision" title="此标题的永久链接">¶</a></h1>
<p>a robot decision module base on BehaviorTree.CPP and ROS2</p>
<section id="install-behaviortree-cpp">
<h2>1. Install BehaviorTree.CPP<a class="headerlink" href="#install-behaviortree-cpp" title="此标题的永久链接">¶</a></h2>
<section id="install-from-source">
<h3>1.1 Install from source<a class="headerlink" href="#install-from-source" title="此标题的永久链接">¶</a></h3>
</section>
<section id="install-groot2">
<h3>1.2 Install Groot2<a class="headerlink" href="#install-groot2" title="此标题的永久链接">¶</a></h3>
</section>
<section id="notice">
<h3>NOTICE<a class="headerlink" href="#notice" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>There are several differences between the official source and that in this repository. I modify the reactive_fallback.cpp(342ce3029e37c8836c0a53ca3e52a975de72cc79). See more details in the commit history.</p></li>
<li><p>This documentation is a digest of the official documentation. For more details, please refer to the <a class="reference external" href="https://www.behaviortree.dev/">official documentation</a>.</p></li>
<li><p>The official documentation <a class="reference external" href="https://www.behaviortree.dev/docs/ros2_integration">recommends way</a> of integrate BehaviorTree.CPP with ROS2 is to use the server-client model. It is good, fine. However, as for the system I am working on, the only task of the decision module is to move the robot to a specific position, so I directly use seperate ros nodes to control the robot.</p></li>
</ul>
</section>
</section>
<section id="a-intro">
<h2>2. A INTRO<a class="headerlink" href="#a-intro" title="此标题的永久链接">¶</a></h2>
<section id="basic-idea">
<h3>Basic Idea<a class="headerlink" href="#basic-idea" title="此标题的永久链接">¶</a></h3>
<p>Unlike a Finite State Machine, a behavior Tree is a tree of hierarchical nodes that controls the flow of execution of “tasks”.</p>
<p>Everytime the tree is ticked, the tree will be traversed from the root node to the leaf node, and the leaf node will return a status code to the parent node, and the parent node will return a status code to the grandparent node, and so on, until the root node is reached.</p>
<p>Though it is easy to understand, there are still some mistakes that are easy to make. And the only way to avoid these mistakes is to make mistakes and learn from them, at least for me.</p>
</section>
</section>
<section id="learning-from-a-detailed-example">
<h2>3. Learning From a Detailed Example<a class="headerlink" href="#learning-from-a-detailed-example" title="此标题的永久链接">¶</a></h2>
<section id="tree-structure">
<h3>Tree Structure<a class="headerlink" href="#tree-structure" title="此标题的永久链接">¶</a></h3>
<p>The tree structure is defined in a xml file. A recommended way to create a tree is to use the Groot2, a graphical editor for BehaviorTree.CPP.</p>
<a class="reference internal image-reference" href="../../_images/behaviour_tree.png"><img alt="../../_images/behaviour_tree.png" src="../../_images/behaviour_tree.png" style="width: 80%;" /></a>
<details>
<summary>Tree Structure in xml file</summary>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;root</span><span class="w"> </span><span class="na">BTCPP_format=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;BehaviorTree</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;RMUL&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ReactiveSequence&gt;</span>
<span class="w">      </span><span class="nt">&lt;RunOnce</span><span class="w"> </span><span class="na">then_skip=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;spin:=false;human_command:=false&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/RunOnce&gt;</span>
<span class="w">      </span><span class="nt">&lt;Topics2Blackboard</span><span class="w"> </span><span class="na">base_front_remain=</span><span class="s">&quot;{base_front_remain}&quot;</span>
<span class="w">                         </span><span class="na">base_shield_enable=</span><span class="s">&quot;{base_shield_enable}&quot;</span>
<span class="w">                         </span><span class="na">remain_hp=</span><span class="s">&quot;{remain_hp}&quot;</span>
<span class="w">                         </span><span class="na">bullet_remaining_num_17mm=</span><span class="s">&quot;{bullet_remaining_num_17mm}&quot;</span>
<span class="w">                         </span><span class="na">game_progress=</span><span class="s">&quot;{game_progress}&quot;</span>
<span class="w">                         </span><span class="na">stage_remain_time=</span><span class="s">&quot;{stage_remain_time}&quot;</span>
<span class="w">                         </span><span class="na">tracking=</span><span class="s">&quot;{tracking}&quot;</span>
<span class="w">                         </span><span class="na">target_armor_id=</span><span class="s">&quot;{target_armor_id}&quot;</span>
<span class="w">                         </span><span class="na">target_position=</span><span class="s">&quot;{target_position}&quot;</span>
<span class="w">                         </span><span class="na">my_outpost_hp=</span><span class="s">&quot;{my_outpost_hp}&quot;</span>
<span class="w">                         </span><span class="na">my_base_hp=</span><span class="s">&quot;{my_base_hp}&quot;</span>
<span class="w">                         </span><span class="na">enemy_outpost_hp=</span><span class="s">&quot;{enemy_outpost_hp}&quot;</span>
<span class="w">                         </span><span class="na">enemy_base_hp=</span><span class="s">&quot;{enemy_base_hp}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;HumanCommand</span><span class="w"> </span><span class="na">human_command=</span><span class="s">&quot;{human_command}&quot;</span>
<span class="w">                    </span><span class="na">human_command_type=</span><span class="s">&quot;{command_type}&quot;</span>
<span class="w">                    </span><span class="na">twist=</span><span class="s">&quot;{twist}&quot;</span>
<span class="w">                    </span><span class="na">goal_point=</span><span class="s">&quot;{setted_point}&quot;</span>
<span class="w">                    </span><span class="na">odom=</span><span class="s">&quot;{relocalization}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Spin</span><span class="w"> </span><span class="na">spin=</span><span class="s">&quot;{spin}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ReactiveFallback</span><span class="w"> </span><span class="na">_while=</span><span class="s">&quot;game_progress==4&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nav_to_human_set_point&quot;</span>
<span class="w">                  </span><span class="na">goal=</span><span class="s">&quot;{setted_point}&quot;</span>
<span class="w">                  </span><span class="na">_skipIf=</span><span class="s">&quot;!human_command&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;SequenceWithMemory</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;GO HOME&quot;</span>
<span class="w">                            </span><span class="na">_while=</span><span class="s">&quot;my_outpost_hp&amp;lt;200&quot;</span>
<span class="w">                            </span><span class="na">_post=</span><span class="s">&quot;spin:=false&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Timeout</span><span class="w"> </span><span class="na">msec=</span><span class="s">&quot;3000&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;get_supply&quot;</span>
<span class="w">                      </span><span class="na">goal=</span><span class="s">&quot;1.0,0.4,0.0,0.0,0.0,0.0,0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/Timeout&gt;</span>
<span class="w">          </span><span class="nt">&lt;KeepRunningUntilFailure&gt;</span>
<span class="w">            </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;spin:=true&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/KeepRunningUntilFailure&gt;</span>
<span class="w">        </span><span class="nt">&lt;/SequenceWithMemory&gt;</span>
<span class="w">        </span><span class="nt">&lt;SequenceWithMemory</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;GET SUPPLY&quot;</span>
<span class="w">                            </span><span class="na">_while=</span><span class="s">&quot;bullet_remaining_num_17mm&amp;lt;=10&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;get_supply&quot;</span>
<span class="w">                    </span><span class="na">goal=</span><span class="s">&quot;0.1,0.1,0.0,0.0,0.0,0.0,0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;KeepRunningUntilFailure&gt;</span>
<span class="w">            </span><span class="nt">&lt;Script</span><span class="w"> </span><span class="na">code=</span><span class="s">&quot;spin:=false&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/KeepRunningUntilFailure&gt;</span>
<span class="w">        </span><span class="nt">&lt;/SequenceWithMemory&gt;</span>
<span class="w">        </span><span class="nt">&lt;ReactiveSequence</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ATTCK!&quot;</span>
<span class="w">                          </span><span class="na">_while=</span><span class="s">&quot;tracking==true&quot;</span>
<span class="w">                          </span><span class="na">_onHalted=</span><span class="s">&quot;spin:=false&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Attack</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Calculate Attack Pose&quot;</span>
<span class="w">                  </span><span class="na">target_position=</span><span class="s">&quot;{target_position}&quot;</span>
<span class="w">                  </span><span class="na">attack_pose=</span><span class="s">&quot;{attack_pose}&quot;</span>
<span class="w">                  </span><span class="na">_onSuccess=</span><span class="s">&quot;spin:=true&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;KeepRunningUntilFailure&gt;</span>
<span class="w">            </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">goal=</span><span class="s">&quot;{attack_pose}&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/KeepRunningUntilFailure&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ReactiveSequence&gt;</span>
<span class="w">        </span><span class="nt">&lt;RetryUntilSuccessful</span><span class="w"> </span><span class="na">num_attempts=</span><span class="s">&quot;1000&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Sequence&gt;</span>
<span class="w">            </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">goal=</span><span class="s">&quot;1.96,-2.12,0.0,0.0,0.0,0.0,0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">goal=</span><span class="s">&quot;1.05,1.25,0.0,0.0,0.0,0.0,0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;Nav2Pose</span><span class="w"> </span><span class="na">goal=</span><span class="s">&quot;2.44,0.68,0.0,0.0,0.0,0.0,0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;AlwaysFailure/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/Sequence&gt;</span>
<span class="w">        </span><span class="nt">&lt;/RetryUntilSuccessful&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ReactiveFallback&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ReactiveSequence&gt;</span>
<span class="w">  </span><span class="nt">&lt;/BehaviorTree&gt;</span>

<span class="w">  </span><span class="cm">&lt;!-- Description of Node Models (used by Groot) --&gt;</span>
<span class="w">  </span><span class="nt">&lt;TreeNodesModel&gt;</span>
<span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;Attack&quot;</span>
<span class="w">            </span><span class="na">editable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;input_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;target_position&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;attack_pose&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;HumanCommand&quot;</span>
<span class="w">            </span><span class="na">editable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;human_command&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;human_command_type&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;twist&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;goal_point&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;odom&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;Nav2Pose&quot;</span>
<span class="w">            </span><span class="na">editable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;input_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;goal&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;Spin&quot;</span>
<span class="w">            </span><span class="na">editable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;input_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;spin&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<span class="w">    </span><span class="nt">&lt;Action</span><span class="w"> </span><span class="na">ID=</span><span class="s">&quot;Topics2Blackboard&quot;</span>
<span class="w">            </span><span class="na">editable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_front_remain&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base_shield_enable&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;remain_hp&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;bullet_remaining_num_17mm&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;game_progress&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stage_remain_time&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tracking&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;target_armor_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;target_position&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;my_outpost_hp&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;my_base_hp&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;enemy_outpost_hp&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;output_port</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;enemy_base_hp&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Action&gt;</span>
<span class="w">  </span><span class="nt">&lt;/TreeNodesModel&gt;</span>

<span class="nt">&lt;/root&gt;</span>
</pre></div>
</div>
</details>
<p>It is east to grasp the intention of the tree. But it readlly take some time to make it right.</p>
</section>
<section id="control-node">
<h3>Control Node<a class="headerlink" href="#control-node" title="此标题的永久链接">¶</a></h3>
<p>Control node manage the logic of the tree. There are three basic types of control node: sequence, fallback(selector), and parallel. Derived from these basic types, there are several other types of control node, such as reactive sequence, reactive fallback, and so on.</p>
<p>The best way to understand them is too see what the node will do when the child node returns RUNNING or FAILURE, and also see what scenario a spcific type of control node should be used.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Type of ControlNode</th>
<th>Child returns RUNNING</th>
<th>Child returns FAILURE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fallback</td>
<td>Tick again</td>
<td>Tick next</td>
</tr>
<tr>
<td>ReactiveFallback</td>
<td>Restart</td>
<td>Tick next</td>
</tr>
<tr>
<td>Sequence</td>
<td>Tick again</td>
<td>Restart</td>
</tr>
<tr>
<td>ReactiveSequence</td>
<td>Restart</td>
<td>Restart</td>
</tr>
<tr>
<td>SequenceWithMemory</td>
<td>Tick again</td>
<td>Tick again</td>
</tr>
</tbody>
</table>
<a class="reference internal image-reference" href="../../_images/fallback.png"><img alt="../../_images/fallback.png" src="../../_images/fallback.png" style="width: 45%;" /></a>
<a class="reference internal image-reference" href="../../_images/reactivefallback.png"><img alt="../../_images/reactivefallback.png" src="../../_images/reactivefallback.png" style="width: 45%;" /></a>
<a class="reference internal image-reference" href="../../_images/Sequence.png"><img alt="../../_images/Sequence.png" src="../../_images/Sequence.png" style="width: 30%;" /></a>
<a class="reference internal image-reference" href="../../_images/ReactiveSequence.png"><img alt="../../_images/ReactiveSequence.png" src="../../_images/ReactiveSequence.png" style="width: 30%;" /></a>
<a class="reference internal image-reference" href="../../_images/SequencewMemory.png"><img alt="../../_images/SequencewMemory.png" src="../../_images/SequencewMemory.png" style="width: 30%;" /></a>
</section>
<section id="action-node">
<h3>Action Node<a class="headerlink" href="#action-node" title="此标题的永久链接">¶</a></h3>
<p>Create custom nodes with inheritance.</p>
<section id="concept">
<h4>Concept<a class="headerlink" href="#concept" title="此标题的永久链接">¶</a></h4>
<p>Since it is highly recommended to implement your own action node based on the <code class="docutils literal notranslate"><span class="pre">SyncActionNode</span></code> or <code class="docutils literal notranslate"><span class="pre">StatefulActionNode</span></code> class, it is necessary to understand the difference between them.</p>
</section>
<section id="syncactionnode">
<h4>SyncActionNode<a class="headerlink" href="#syncactionnode" title="此标题的永久链接">¶</a></h4>
<ul class="simple">
<li><p>return only <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code> or <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.</p></li>
<li><p>use SyncActionNode if</p></li>
<li><p>override the <code class="docutils literal notranslate"><span class="pre">tick()</span></code> method is required.</p></li>
<li><p>override the <code class="docutils literal notranslate"><span class="pre">providedPorts()</span></code> method if you want to use the <code class="docutils literal notranslate"><span class="pre">setInput&lt;T&gt;()</span></code> or <code class="docutils literal notranslate"><span class="pre">getOutput&lt;T&gt;()</span></code> method.</p></li>
</ul>
<details>
    <summary> Attack Node Example </summary>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//File: attck.hpp</span>

<span class="cp">#ifndef RM_DECISION_ATTACK_HPP_</span>
<span class="cp">#define RM_DECISION_ATTACK_HPP_</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;behaviortree_cpp/bt_factory.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rclcpp/rclcpp.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geometry_msgs/msg/point_stamped.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sensor_msgs/msg/point_cloud2.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nav_msgs/msg/odometry.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;auto_aim_interfaces/msg/target.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;visualization_msgs/msg/marker_array.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rclcpp/qos.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_cloud.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl_conversions/pcl_conversions.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rm_decision_cpp/custume_types.hpp&quot;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;optional&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="p">;</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">rm_decision</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">Attack</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SyncActionNode</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Attack</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>

<span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">tick</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="nf">providedPorts</span><span class="p">();</span>

<span class="w">  </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PointCloud2</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">obs_pcl_sub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Odometry</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">state_estimation_sub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">MarkerArray</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">attack_pose_vis_pub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">visualization_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Marker</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">final_attack_pose_vis_pub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PointCloud2</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">croped_pcl_pub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">node_</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">target_tracking_</span><span class="p">,</span><span class="n">obs_pcl_received_</span><span class="p">,</span><span class="n">vehicle_pose_received_</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">distance_to_target_</span><span class="p">,</span><span class="n">vehicle_dim_</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">vehicle_X_</span><span class="p">,</span><span class="n">vehicle_Y_</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pose_candidate_num</span><span class="p">,</span><span class="n">min_obs_num_</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">obs_intensity_threshold_</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">gimble_frame_</span><span class="p">,</span><span class="n">global_frame_</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">obs_pcl_topic_</span><span class="p">,</span><span class="n">target_topic_</span><span class="p">;</span>
<span class="w">    </span><span class="n">auto_aim_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Target</span><span class="w"> </span><span class="n">target_info_</span><span class="p">;</span>
<span class="w">    </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span><span class="w"> </span><span class="n">target_point_</span><span class="p">;</span>
<span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">obs_pcl_</span><span class="p">;</span>
<span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">surrouding_obs_</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">obs_pcl_callback_</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PointCloud2</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">state_estimation_callback_</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nav_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Odometry</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// end namespace rm_decision</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</details>
</section>
<section id="statefulactionnode">
<h4>StatefulActionNode<a class="headerlink" href="#statefulactionnode" title="此标题的永久链接">¶</a></h4>
<ul class="simple">
<li><p>return <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>, or <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code>.</p></li>
<li><p>use StatefulActionNode if</p>
<ul>
<li><p>the action node needs to be interrupted by another node.</p></li>
</ul>
</li>
</ul>
<details>
    <summary> Nav2Pose Node Example </summary>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//FILE: nav2pose.hpp</span>
<span class="cp">#ifndef RM_DECISION_NAV2POSE_HPP_</span>
<span class="cp">#define RM_DECISION_NAV2POSE_HPP_</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;behaviortree_cpp/bt_factory.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rclcpp/rclcpp.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geometry_msgs/msg/point_stamped.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;geometry_msgs/msg/pose_stamped.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;std_msgs/msg/bool.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;std_msgs/msg/float32.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nav_msgs/msg/odometry.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;action_msgs/msg/goal_status_array.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rm_decision_cpp/custume_types.hpp&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">BT</span><span class="p">;</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">rm_decision</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">Nav2Pose</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">StatefulActionNode</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Nav2Pose</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NodeConfig</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// this function is invoked once at the beginning.</span>
<span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">onStart</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// If onStart() returned RUNNING, we will keep calling</span>
<span class="w">    </span><span class="c1">// this method until it return something different from RUNNING</span>
<span class="w">    </span><span class="n">NodeStatus</span><span class="w"> </span><span class="nf">onRunning</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// callback to execute if the action was aborted by another node</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onHalted</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">PortsList</span><span class="w"> </span><span class="nf">providedPorts</span><span class="p">();</span>

<span class="w">  </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PoseStamped</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">goal_pub_</span><span class="p">;</span>

<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">action_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">GoalStatusArray</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">planner_status_sub_</span><span class="p">;</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">action_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">GoalStatusArray</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">controller_status_sub_</span><span class="p">;</span>

<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">node_</span><span class="p">;</span>
<span class="w">    </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PoseStamped</span><span class="w"> </span><span class="n">goal_</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">goal_topic_</span><span class="p">,</span><span class="n">planner_status_sub_topic_</span><span class="p">,</span><span class="n">controller_status_sub_topic_</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">plannerStatusCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">action_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">GoalStatusArray</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">controllerStatusCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">action_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">GoalStatusArray</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int8_t</span><span class="w"> </span><span class="n">planner_status_</span><span class="p">,</span><span class="n">controller_status_</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// end namespace rm_decision</span>

<span class="cp">#endif</span>
</pre></div>
</div>
</details>
</section>
<section id="steps-of-creating-a-custom-node">
<h4>Steps of Creating a Custom Node<a class="headerlink" href="#steps-of-creating-a-custom-node" title="此标题的永久链接">¶</a></h4>
<ol class="arabic simple">
<li><p>Create a new class that inherits from <code class="docutils literal notranslate"><span class="pre">SyncActionNode</span></code> or <code class="docutils literal notranslate"><span class="pre">StatefulActionNode</span></code>.</p></li>
<li><p>Override the required methods.</p></li>
<li><p>Define the ports that the node will use.</p></li>
</ol>
</section>
</section>
<section id="scripting">
<h3>Scripting<a class="headerlink" href="#scripting" title="此标题的永久链接">¶</a></h3>
<p>Behavior Tree 4.X introduces a simple but powerful new concept: a scripting language within XML.</p>
<ul class="simple">
<li><p>simplify the tree structure</p></li>
<li><p>make the tree more readable</p></li>
<li><p>largely replace the use of the <code class="docutils literal notranslate"><span class="pre">Decorator</span></code> or <code class="docutils literal notranslate"><span class="pre">Condition</span></code> node.</p></li>
</ul>
<p>See <a class="reference external" href="https://www.behaviortree.dev/docs/guides/scripting/">official tutorial</a> for more details.</p>
</section>
</section>
<section id="usual-mistakes">
<h2>Usual Mistakes<a class="headerlink" href="#usual-mistakes" title="此标题的永久链接">¶</a></h2>
<section id="fetch-beer">
<h3>Fetch Beer<a class="headerlink" href="#fetch-beer" title="此标题的永久链接">¶</a></h3>
<a class="reference internal image-reference" href="../../_images/FetchBeer.png"><img alt="../../_images/FetchBeer.png" src="../../_images/FetchBeer.png" style="width: 80%;" /></a>
<ul class="simple">
<li><p>the tree on the left side will always return SUCCESS, no matter if we have actually grabbed the beer.</p></li>
<li><p>the tree on the right side would return SUCCESS if the beer was there, FAILURE otherwise.</p></li>
</ul>
</section>
<section id="custom-type">
<h3>CUSTOM TYPE<a class="headerlink" href="#custom-type" title="此标题的永久链接">¶</a></h3>
<p>BehaviorTree.CPP supports the automatic conversion of strings into common types, such as int, long, double, bool, NodeStatus, etc. User-defined types can be supported easily as well.</p>
<section id="how-to-define-a-custom-type">
<h4>How to Define a Custom Type<a class="headerlink" href="#how-to-define-a-custom-type" title="此标题的永久链接">¶</a></h4>
<p>and by invoke res=getInput<T>(“key”) or setOutput<T>(“key”, value), the stringView will be automatically converted to the type T.</p>
<p>while and skipif</p>
<p>on halt and on post</p>
<p>different sequence</p>
</section>
</section>
</section>
<section id="reference-resources">
<h2>Reference &amp; Resources<a class="headerlink" href="#reference-resources" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.behaviortree.dev/">BehaviorTree.CPP</a></p></li>
<li><p><a class="reference external" href="https://github.com/BehaviorTree/BehaviorTree.CPP/tree/master/examples">BehaviorTree.CPP GitHub Example</a></p></li>
</ul>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../ROS/executos.html"
       title="上一章">← Manage how the callbaks are called: Exeturos &amp; CallbackGroups &amp; Qos</a>
  </li>
  <li class="next">
    <a href="ProbablisticRobotics.html"
       title="下一章">Probablistic Robotics →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; 版权所有 2023, PolarisXQ.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>