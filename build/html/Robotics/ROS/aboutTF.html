<!DOCTYPE html>
<html  lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>Learning TF2</title>
    
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../../_static/theme-vendors.js"></script> -->
      <script src="../../_static/theme.js" defer></script>
    
      <link rel="shortcut icon" href="../../_static/madcat_mini.png"/>
  <link rel="index" title="索引" href="../../genindex.html" />
  <link rel="search" title="搜索" href="../../search.html" />
  <link rel="next" title="&lt;no title&gt;" href="migration.html" />
  <link rel="prev" title="Learning Control" href="../Navigation/control.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../index.html" class="home-link">
    
      <img class="logo" src="../../_static/madcat_mini.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Daily Report
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         System
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Development Related
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Docker
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         SLAM
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Navigation
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link  router-link-active">
         ROS
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Robotics etc.
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         CV
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Miscellaneous
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/PolarisXQ"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Daily Report
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         System
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Development Related
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Docker
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         SLAM
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Navigation
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link  router-link-active">
         ROS
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Robotics etc.
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         CV
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../index.html#welcome-to-polaris-notebook"
         class="nav-link ">
         Miscellaneous
      </a>
    </div>
  



  
    <div class="nav-item">
      <a href="https://github.com/PolarisXQ"
        class="nav-link external">
          Github <outboundlink></outboundlink>
      </a>
    </div>
  

            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">快速搜索</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="搜索" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Daily Report</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../report/report.html" class="reference internal ">开发记录(09.15-10.31)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../report/report2.html" class="reference internal ">开发记录(11.01-12.31)</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../report/report3.html" class="reference internal ">开发记录 2024.01.01-now</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">System</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Sys/Linux/bind_device.html" class="reference internal ">Bind a USB device under a static name</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Sys/Linux/Miscellaneous.html" class="reference internal ">Miscellaneous</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Development Related</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../develop/rule.html" class="reference internal ">开发的姿势</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/submodel.html" class="reference internal ">关联仓库的管理</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/CI.html" class="reference internal ">配置CI节点</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../develop/git.html" class="reference internal ">GIT</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Docker</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/docker.html" class="reference internal ">Dockernize Everything!</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/DevContainer.html" class="reference internal ">DevContainer: What Why and How[Optional]</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/workflow.html" class="reference internal ">Introduce to our WorkFlow</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/CustomImage.html" class="reference internal ">Step by Step in detail: Prepare Docker Image</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/RunDevEnv.html" class="reference internal ">Step by Step in detail: Launch the Development Workspace</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/CI.html" class="reference internal ">Step by Step in detail: Continuous Integration</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/deploy.html" class="reference internal ">Step by Step in detail: Deploy in NUC</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Docker/UsefulCommand.html" class="reference internal ">Some Useful Command for Docker</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">SLAM</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/overview.html" class="reference internal ">A Simple Overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/RecommendReading.html" class="reference internal ">阅读推荐</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/relocalization.html" class="reference internal ">Relocalization Method</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/Traditional/ORB-SLAM3.html" class="reference internal ">ORB_SLAM</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/SLAM_w_NN.html" class="reference internal ">SLAM with Nerual Network</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/MID360.html" class="reference internal ">MID360激光雷达的装配说明</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../SLAM/KalmanFilter.html" class="reference internal ">Learning Kalman Filter</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Navigation</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/Overview.html" class="reference internal ">Robot Path Planning</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/CMUSeries.html" class="reference internal ">CMU Exploration Series</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/PathTracking.html" class="reference internal ">Path Tracking Algorithms Overview</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/farplanner_param.html" class="reference internal ">FarPlanner调参笔记</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Navigation/control.html" class="reference internal ">Learning Control</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">ROS</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Learning TF2</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#header-files" class="reference internal">Header Files</a></li>
                
                  <li class="toctree-l2"><a href="#broadcaster-listeners-buffers" class="reference internal">Broadcaster Listeners & Buffers</a></li>
                
                  <li class="toctree-l2"><a href="#time" class="reference internal">Time</a></li>
                
                  <li class="toctree-l2"><a href="#debug" class="reference internal">Debug</a></li>
                
                  <li class="toctree-l2"><a href="#quaternion" class="reference internal">Quaternion</a></li>
                
                  <li class="toctree-l2"><a href="#conversion" class="reference internal">Conversion</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="migration.html" class="reference internal "><no title></a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="msg_filter.html" class="reference internal ">Message_filter and TimeSynchronizer</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="Composition.html" class="reference internal ">Composition and Intra-process Communication</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="executos.html" class="reference internal ">Manage how the callbaks are called: Exeturos & CallbackGroups & Qos</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Robotics etc.</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../Miscellaneous/behaviour_tree.html" class="reference internal ">rm_decision</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Miscellaneous/ProbablisticRobotics.html" class="reference internal "><no title></a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">CV</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../CV/basic.html" class="reference internal ">Basic</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/Yolo.html" class="reference internal ">Yolo</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/multiobj_track.html" class="reference internal ">Tracking Multi-Objects</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../CV/issue.html" class="reference internal ">Miscellaneous things</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../index.html#welcome-to-polaris-notebook">Miscellaneous</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/migrationcv3tocv4.html" class="reference internal ">Migrate from OpenCV3 to CV4</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/roadtoslam.html" class="reference internal ">On the bumpy road to SLAM</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/Cmake.html" class="reference internal ">How to ues Cmake</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/develowithnuc.html" class="reference internal ">Develop With NUC</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../../Miscellaneous/JKB-NetWork.html" class="reference internal ">SCU极客邦服务器使用指南</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
    <li>Learning TF2</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../Navigation/control.html"
       title="上一章">← Learning Control</a>
  </li>
  <li class="next">
    <a href="migration.html"
       title="下一章">&lt;no title&gt; →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section class="tex2jax_ignore mathjax_ignore" id="learning-tf2">
<h1>Learning TF2<a class="headerlink" href="#learning-tf2" title="此标题的永久链接">¶</a></h1>
<section id="header-files">
<h2>Header Files<a class="headerlink" href="#header-files" title="此标题的永久链接">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// TransformStamped message type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;geometry_msgs/msg/transform_stamped.hpp&quot;</span>

<span class="c1">// convenient functions for converting Euler angles to quaternions and vice versa</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2/LinearMath/Quaternion.h&quot;</span>

<span class="c1">// StaticTransformBroadcaster</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2_ros/static_transform_broadcaster.h&quot;</span>

<span class="c1">// TransformBroadcaster </span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2_ros/transform_broadcaster.h&quot;</span>

<span class="c1">// Buffer</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2_ros/buffer.h&quot;</span>

<span class="c1">// TransformListener</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2_ros/transform_listener.h&quot;</span>

<span class="c1">// </span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tf2_ros/message_filter.h&quot;</span>
</pre></div>
</div>
</section>
<section id="broadcaster-listeners-buffers">
<h2>Broadcaster Listeners &amp; Buffers<a class="headerlink" href="#broadcaster-listeners-buffers" title="此标题的永久链接">¶</a></h2>
<section id="broadcaster">
<h3>Broadcaster<a class="headerlink" href="#broadcaster" title="此标题的永久链接">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// declaration</span>
<span class="c1">// shared ptr is used to avoid memory leaks</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">StaticTransformBroadcaster</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tf_static_broadcaster_</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">TransformBroadcaster</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tf_broadcaster_</span><span class="p">;</span>

<span class="c1">// definition</span>
<span class="n">tf_static_broadcaster_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">StaticTransformBroadcaster</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="n">tf_broadcaster_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">TransformBroadcaster</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="c1">// broadcast</span>
<span class="n">tf_static_broadcaster_</span><span class="o">-&gt;</span><span class="n">sendTransform</span><span class="p">(</span><span class="n">tf_static_transform</span><span class="p">);</span>
<span class="c1">// &quot;tf2_ros/static_transform_broadcaster.h&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sendTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sendTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">transforms</span><span class="p">);</span>

<span class="n">tf_broadcaster_</span><span class="o">-&gt;</span><span class="n">sendTransform</span><span class="p">(</span><span class="n">tf_transform</span><span class="p">)</span>
<span class="c1">// &quot;tf2_ros/transform_broadcaster.h&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="n">sendTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sendTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">transforms</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="listener-buffer">
<h3>Listener &amp; Buffer<a class="headerlink" href="#listener-buffer" title="此标题的永久链接">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// declaration</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">TransformListener</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tf_listener_</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="p">;</span>

<span class="c1">// definition</span>
<span class="n">tf_buffer_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">());</span>
<span class="n">tf_listener_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">tf2_ros</span><span class="o">::</span><span class="n">TransformListener</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">tf_buffer_</span><span class="p">);</span>

<span class="c1">// query the listener for a specific transformation. </span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span><span class="w"> </span><span class="n">transform</span><span class="p">;</span>
<span class="k">try</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">odom_now_tf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="o">-&gt;</span><span class="n">lookupTransform</span><span class="p">(</span><span class="n">toFrameRel</span><span class="p">,</span><span class="w"> </span><span class="n">fromFrameRel</span><span class="p">,</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">TimePointZero</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">TransformException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Transform error: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// &quot;tf2_ros/buffer.h&quot;</span>
<span class="c1">// commonly used functions</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span>
<span class="w">  </span><span class="n">lookupTransform</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_frame</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">TimePoint</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span>
<span class="w">  </span><span class="nf">lookupTransform</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_frame</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Duration</span><span class="o">::</span><span class="n">from_nanoseconds</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="c1">// used when the time of the source and target frames are different, for more examples, see TIME section below</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span>
<span class="w">  </span><span class="nf">lookupTransform</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">TimePoint</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_time</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">TimePoint</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_time</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">fixed_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">TransformStamped</span>
<span class="w">  </span><span class="nf">lookupTransform</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">target_time</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_frame</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">source_time</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">fixed_frame</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Duration</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Duration</span><span class="o">::</span><span class="n">from_nanoseconds</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tf_listener</span></code> is not explicitly called. Once the listener is created, it starts receiving tf2 transformations over the wire(i.e. stores all the coordinate transforms coming from the different tf2 broadcasters.), and buffers them for up to 10 seconds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">canTransform</span></code> has the same format as lookupTransform, but it returns a boolean value indicating whether the transformation is available or not.</p></li>
</ul>
</section>
</section>
<section id="time">
<h2>Time<a class="headerlink" href="#time" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>For tf2, time 0 means “the latest available”</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">transformStamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="o">-&gt;</span><span class="n">lookupTransform</span><span class="p">(</span>
<span class="w">   </span><span class="n">toFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">fromFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">tf2</span><span class="o">::</span><span class="n">TimePointZero</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The tf2 package has it’s own time type tf2::TimePoint, which is different from rclcpp::Time. Many APIs in the package tf2_ros automatically convert between rclcpp::Time and tf2::TimePoint.</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>
<span class="n">transformStamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="o">-&gt;</span><span class="n">lookupTransform</span><span class="p">(</span>
<span class="w">   </span><span class="n">toFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">fromFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">now</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Notice that it takes some time before a new transform gets into the buffer, it induce the INFO message if you use <code class="docutils literal notranslate"><span class="pre">now(rclcpp：：Time())</span></code> rather then <code class="docutils literal notranslate"><span class="pre">tf2::TimePointZero</span></code></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1629873136</span>.345688064<span class="o">]</span><span class="w"> </span><span class="o">[</span>listener<span class="o">]</span>:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>transform<span class="w"> </span>turtle1<span class="w"> </span>to<span class="w"> </span>turtle2:<span class="w"> </span>Lookup<span class="w"> </span>would
require<span class="w"> </span>extrapolation<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>future.<span class="w">  </span>Requested<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="m">1629873136</span>.345539<span class="w"> </span>but<span class="w"> </span>the<span class="w"> </span>latest<span class="w"> </span>data
is<span class="w"> </span>at<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="m">1629873136</span>.338804,<span class="w"> </span>when<span class="w"> </span>looking<span class="w"> </span>up<span class="w"> </span>transform<span class="w"> </span>from<span class="w"> </span>frame<span class="w"> </span><span class="o">[</span>turtle1<span class="o">]</span><span class="w"> </span>to<span class="w"> </span>frame<span class="w"> </span><span class="o">[</span>turtle2<span class="o">]</span>
<span class="nv">tf_listener_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>std::make_shared&lt;tf2_ros::TransformListener&gt;<span class="o">(</span>*tf_buffer_<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>to get rid of “extrapolation into the future” INFO when using <code class="docutils literal notranslate"><span class="pre">now</span></code>, add timeout parameter to the lookupTransform function</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>
<span class="n">transformStamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="o">-&gt;</span><span class="n">lookupTransform</span><span class="p">(</span>
<span class="w">   </span><span class="n">toFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">fromFrameRel</span><span class="p">,</span>
<span class="w">   </span><span class="n">now</span><span class="p">,</span>
<span class="w">   </span><span class="mi">50</span><span class="n">ms</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>(Advanced API for lookupTransform())[<a class="reference external" href="https://docs.ros.org/en/humble/Tutorials/Intermediate/Tf2/Time-Travel-With-Tf2-Cpp.html#advanced-api-for-lookuptransform">https://docs.ros.org/en/humble/Tutorials/Intermediate/Tf2/Time-Travel-With-Tf2-Cpp.html#advanced-api-for-lookuptransform</a>]</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>
<span class="n">rclcpp</span><span class="o">::</span><span class="n">Time</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf_buffer_</span><span class="o">-&gt;</span><span class="n">lookupTransform</span><span class="p">(</span>
<span class="w">    </span><span class="n">toFrameRel</span><span class="p">,</span>
<span class="w">    </span><span class="n">now</span><span class="p">,</span>
<span class="w">    </span><span class="n">fromFrameRel</span><span class="p">,</span>
<span class="w">    </span><span class="n">when</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;world&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="mi">50</span><span class="n">ms</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="debug">
<h2>Debug<a class="headerlink" href="#debug" title="此标题的永久链接">¶</a></h2>
<p>[INFO] [1630223557.477636052] [tf2_echo]: Waiting for transform turtle3 -&gt;  turtle1:
Invalid frame ID “turtle3” passed to canTransform argument target_frame - frame does
not exist</p>
<p>[INFO] [1630223557.477636052] [tf2_echo]: Waiting for transform turtle3 -&gt;  turtle1:
Invalid frame ID “turtle3” passed to canTransform argument target_frame - frame does
not exist</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check specific frames</span>
ros2<span class="w"> </span>run<span class="w"> </span>tf2_ros<span class="w"> </span>tf2_echo<span class="w"> </span>turtle3<span class="w"> </span>turtle1

<span class="c1"># check all the frames, it will generate a pdf file</span>
ros2<span class="w"> </span>run<span class="w"> </span>tf2_tools<span class="w"> </span>view_frames

<span class="c1"># check the timestamp</span>
ros2<span class="w"> </span>run<span class="w"> </span>tf2_ros<span class="w"> </span>tf2_monitor<span class="w"> </span>turtle2<span class="w"> </span>turtle1
</pre></div>
</div>
</section>
<section id="quaternion">
<h2>Quaternion<a class="headerlink" href="#quaternion" title="此标题的永久链接">¶</a></h2>
</section>
<section id="conversion">
<h2>Conversion<a class="headerlink" href="#conversion" title="此标题的永久链接">¶</a></h2>
<p>conversion between tf2 and geometry_msgs\eigen\bullet\KDL is available</p>
<p>see prototype in tf2_geometry_msgs.hpp\tf2_eigen.hpp\tf2_bullet.hpp\tf2_kdl.hpp for more details</p>
<p>tf2::doTransform(odom_now, odom_now, odom_now_tf);</p>
<p>inverseTime</p>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../Navigation/control.html"
       title="上一章">← Learning Control</a>
  </li>
  <li class="next">
    <a href="migration.html"
       title="下一章">&lt;no title&gt; →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; 版权所有 2023, PolarisXQ.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>